<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Happy Birthday üíñ</title>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@600&family=Poppins:wght@400;600&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg1:#ffe4ec; --bg2:#fff8e7;
      --accent:#ff5fa2; --accent2:#ff8c5f; --text:#2a2a2a;

      /* Transition tuning */
      --hold-pretitle: 2600ms;
      --fade-duration: 1600ms;
      --cross-overlap: 700ms;
    }

    *{box-sizing:border-box}
    html,body{height:100%;}
    body{
      margin:0; font-family: Poppins, system-ui, -apple-system, Segoe UI, Roboto, sans-serif; color:var(--text);
      background: radial-gradient(1200px 800px at 10% 10%, var(--bg1), transparent),
                  radial-gradient(1200px 800px at 90% 10%, var(--bg2), transparent),
                  #fff;
      overflow-x:hidden;
    }
    .wrap{max-width:980px; margin:0 auto; padding:32px 16px 80px; text-align:center; position:relative}

    /* ======= Heading sequence ======= */
    .heading-stack{
      position: relative;
      display: grid;
      place-items: center;
      margin-bottom: 6px;
      min-height: clamp(90px, 13vw, 140px);
      z-index: 3; /* above floaters */
    }
    .title-fx{
      position:absolute; inset:-10px -20px;
      pointer-events:none; z-index:0; overflow:visible;
    }

    .pretitle{
      position: relative; z-index:1;
      font-family:"Dancing Script", cursive;
      font-size: clamp(28px, 5.5vw, 60px);
      line-height: 1.25;
      padding: 4px 0;
      margin: 8px 0 2px;
      background: linear-gradient(90deg, var(--accent), var(--accent2));
      -webkit-background-clip:text; background-clip:text; color:transparent;
      text-shadow: 0 6px 18px #ff5fa226;
      opacity:0; transform: translateY(8px);
      transition: opacity var(--fade-duration) ease, transform var(--fade-duration) ease;
    }
    .pretitle.show{ opacity:1; transform:translateY(0); }
    .pretitle.hide{ opacity:0; transform:translateY(-8px); }

    h1{
      position: relative; z-index:1;
      font-family:"Dancing Script";
      font-size: clamp(44px, 7vw, 92px);
      line-height:1.05; margin:16px 0 8px;
      background: linear-gradient(90deg, var(--accent), var(--accent2));
      -webkit-background-clip:text; background-clip:text; color:transparent;
      text-shadow: 0 8px 24px #ff5fa233;
      opacity:0; transform: translateY(8px);
      transition: opacity var(--fade-duration) ease, transform var(--fade-duration) ease;
    }
    h1.show{ opacity:1; transform:translateY(0); }

    .subtitle{
      font-size: clamp(16px, 2.8vw, 22px);
      opacity:.9; margin-bottom:24px;
      position: relative; z-index: 3;
    }
    .type{
      display:inline-block; padding-right:4px; white-space:nowrap; overflow:hidden;
      animation: caret 1s steps(1) infinite;
    }
    @keyframes caret{50%{border-color:transparent}}

    .btn{
      display:inline-flex; align-items:center; justify-content:center;
      border:none; padding:20px 28px; font-size:28px; border-radius:18px; cursor:pointer;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      color:#fff; box-shadow: 0 12px 28px #ff5fa255;
      transition: transform .08s ease, filter .2s ease;
      position: relative; z-index: 3;
    }
    .btn:active{ transform: translateY(1px) scale(0.99) }

    .card{
      margin:24px auto; max-width:800px; background:#fff; border-radius:18px; padding:16px;
      box-shadow: 0 20px 60px #1f16400d, 0 6px 20px #ff5fa218; backdrop-filter: blur(5px);
      border:1px solid #0000000e;
      position: relative; z-index: 2;
    }
    .gif-stage{
      min-height: 280px; display:grid; place-items:center; border-radius:14px; overflow:hidden;
      background: repeating-conic-gradient(from 0deg, #fff 0 10deg, #fff7fb 10deg 20deg);
      position:relative;
    }
    .gif-stage img{max-width:100%; max-height:520px; display:block}

    .gallery{
      --size:110px;
      display:flex; flex-wrap:wrap; gap:14px; justify-content:center; margin-top:10px;
    }
    .gallery .ph{
      width:var(--size); height:var(--size); border-radius:16px; overflow:hidden; position:relative;
      box-shadow: 0 10px 20px #00000017; transform: translateZ(0);
      transition: transform .2s ease;
      cursor: zoom-in;
    }
    .gallery .ph:hover{ transform: translateY(-4px) }
    .gallery img{width:100%; height:100%; object-fit:cover; display:block}

    /* Sparkles */
    .sparkle{
      position:absolute; top:0; left:0;
      width:8px; height:8px; border-radius:50%;
      background: radial-gradient(circle, #fff 0%, #fff 40%, rgba(255,255,255,0) 70%);
      opacity:0; transform: translate(-50%, -50%) scale(.4);
      box-shadow: 0 0 8px rgba(255,255,255,.6);
      animation: sp-pop .9s ease-out forwards, sp-drift 1.8s ease-out forwards;
    }
    .sparkle.tint1{ background: radial-gradient(circle, #fff 0%, #ffe6f1 40%, rgba(255,230,241,0) 70%); }
    .sparkle.tint2{ background: radial-gradient(circle, #fff 0%, #ffe9d9 40%, rgba(255,233,217,0) 70%); }
    .sparkle.tint3{ background: radial-gradient(circle, #fff 0%, #f7fff1 40%, rgba(247,255,241,0) 70%); }
    @keyframes sp-pop{ 0%{ opacity:0; transform: translate(-50%,-50%) scale(.3) } 30%{ opacity:1; transform: translate(-50%,-50%) scale(1) } 100%{ opacity:0; transform: translate(-50%,-50%) scale(1.4) } }
    @keyframes sp-drift{ 0%{ filter: blur(0px) } 100%{ filter: blur(1px) } }

    /* ===== Floaty full-page layer ===== */
    .effects{
      position: fixed; inset: 0; pointer-events: none; overflow: hidden;
      z-index: 1;
    }

    @keyframes floaty {
      0%   { transform: translate3d(0,0,0) rotate(0deg);   opacity: var(--op, .95); }
      50%  { transform: translate3d(var(--dx, 18px), var(--dy, 22px), 0) rotate(180deg); }
      100% { transform: translate3d(calc(var(--dx, 18px) * 2), calc(var(--dy, 22px) * 2), 0) rotate(360deg); opacity: var(--op, .95); }
    }
    .float-confetti{
      position:absolute; width:8px; height:14px; border-radius:2px;
      opacity:.96;
      animation: floaty var(--dur, 16s) linear infinite;
      will-change: transform;
    }
    .float-emoji{
      position:absolute; font-size: var(--size, 22px);
      filter: drop-shadow(0 6px 8px rgba(0,0,0,.15));
      animation: floaty var(--dur, 18s) linear infinite;
      will-change: transform;
    }
    .float-heart{
      position:absolute; font-size: var(--size, 22px);
      filter: drop-shadow(0 6px 8px rgba(0,0,0,.12));
      animation: floaty var(--dur, 20s) linear infinite;
      will-change: transform;
    }

    /* Burst hearts (for GIF button click) */
    .burst-heart{
      position:absolute; font-size:18px; opacity:0;
      animation: burstRise 4s linear forwards;
    }
    @keyframes burstRise{
      0%{ transform: translateY(10vh) scale(.6); opacity:0 }
      10%{ opacity:.9 }
      100%{ transform: translateY(-110vh) scale(1.3); opacity:0 }
    }

    /* ===== Lightbox (click-to-expand) ===== */
    .lightbox{
      position: fixed; inset: 0; display: none;
      align-items: center; justify-content: center;
      background: rgba(0,0,0,.55);
      backdrop-filter: blur(2px);
      z-index: 9999;
      animation: lbFade .2s ease;
    }
    .lightbox.show{ display:flex; }
    @keyframes lbFade{ from{ opacity:0 } to{ opacity:1 } }

    .lightbox-inner{
      position: relative; padding: 0;
      max-width: min(92vw, 1000px);
      max-height: 90vh;
      border-radius: 18px;
      box-shadow: 0 30px 80px rgba(0,0,0,.35), 0 8px 22px rgba(0,0,0,.2);
      overflow: hidden;
      background: #0000;
    }
    .lightbox-img{
      display:block; width:100%; height:auto; max-height:90vh; object-fit:contain;
      transform: scale(.92); opacity: 0;
      animation: lbZoom .22s ease forwards;
    }
    @keyframes lbZoom{ to{ transform: scale(1); opacity:1 } }

    .lb-close{
      position:absolute; top:8px; right:8px;
      border:none; background:#0000007a; color:#fff; width:36px; height:36px;
      border-radius:10px; font-size:20px; line-height:36px; cursor:pointer;
      backdrop-filter: blur(3px);
    }
    .lb-close:active{ transform: translateY(1px) }

    /* ===== Floating letter button ===== */
    .fab-letter{
      position: fixed; right:16px; bottom:16px;
      z-index: 10050;
      width:56px; height:56px; border-radius:16px; border:none; cursor:pointer;
      font-size:28px; line-height:56px;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      color:#fff; box-shadow: 0 14px 30px rgba(255,95,162,.35), 0 6px 16px rgba(0,0,0,.15);
      transition: transform .08s ease;
    }
    .fab-letter:active{ transform: translateY(1px) }

    /* ===== Floating audio button (NEW) ===== */
    .fab-audio{
      position: fixed; left:16px; bottom:16px;
      z-index: 10050;
      width:56px; height:56px; border-radius:16px; border:none; cursor:pointer;
      font-size:28px; line-height:56px;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      color:#fff; box-shadow: 0 14px 30px rgba(255,95,162,.35), 0 6px 16px rgba(0,0,0,.15);
      transition: transform .08s ease;
    }
    .fab-audio:active{ transform: translateY(1px) }

    /* ===== Letter modal ===== */
    .letter-modal{
      position: fixed; inset: 0; display: none;
      align-items: center; justify-content: center;
      background: rgba(30, 12, 24, .55);
      backdrop-filter: blur(2px);
      z-index: 10060;
      animation: lbFade .2s ease;
    }
    .letter-modal.show{ display:flex; }

    .letter-card{
      position: relative;
      width: min(92vw, 760px);
      max-height: 86vh;
      border-radius: 18px;
      padding: 26px 22px;
      overflow: auto;
      box-shadow: 0 30px 80px rgba(0,0,0,.35), 0 8px 22px rgba(0,0,0,.2);
      background:
        radial-gradient(140% 100% at 10% 0%, #fff7fb 0%, #fff 40%),
        radial-gradient(140% 100% at 90% 100%, #fff3e8 0%, #fff 40%);
      /* light paper lines */
      background-image:
        repeating-linear-gradient(#0000, #0000 36px, #ffe9f6 37px, #0000 38px),
        radial-gradient(140% 100% at 10% 0%, #fff7fb 0%, #fff 40%),
        radial-gradient(140% 100% at 90% 100%, #fff3e8 0%, #fff 40%);
      transform: translateY(8px) scale(.98);
      opacity: 0;
      animation: letterIn .35s ease forwards;
    }
    @keyframes letterIn{ to{ transform: translateY(0) scale(1); opacity:1 } }

    .letter-title{
      font-family: "Dancing Script", cursive;
      font-size: clamp(28px, 4.4vw, 44px);
      margin: 4px 0 10px;
      background: linear-gradient(90deg, var(--accent), var(--accent2));
      -webkit-background-clip: text; background-clip: text; color: transparent;
    }
    .letter-body{
      text-align: left;
      font-size: clamp(15px, 2.4vw, 18px);
      line-height: 1.75;
      color: #303030;
    }
    .letter-sign{
      margin-top: 18px;
      font-family: "Dancing Script", cursive;
      font-size: clamp(22px, 3.8vw, 32px);
      text-align: right;
    }
    .letter-close{
      position:absolute; top:10px; right:10px;
      border:none; background:#0000007a; color:#fff; width:38px; height:38px;
      border-radius:10px; font-size:20px; line-height:38px; cursor:pointer;
      backdrop-filter: blur(3px);
    }
    .letter-close:active{ transform: translateY(1px) }
  </style>
</head>
<body>
  <!-- üéµ Background music (plays after any click/tap anywhere) -->
  <audio id="bgm" preload="auto" loop playsinline>
    <source src="./song2.mp3" type="audio/mpeg">
  </audio>

  <div class="effects" id="effects"></div>

  <div class="wrap">
    <div class="heading-stack">
      <div class="title-fx" id="titleFX"></div>
      <div class="pretitle" id="preTitle">It‚Äôs my Bebe‚Äôs Birthday</div>
      <h1 id="title">Happy Birthday <span id="name">Nitika</span>! üéâ</h1>
    </div>

    <div class="subtitle">
      <span class="type" id="typeLine">Happy Birthday Bebe üéÇ</span>
    </div>

    <button class="btn" id="gifBtn">üíù</button>

    <div class="card" style="margin-top:18px">
      <div class="gif-stage" id="stage">
        <img id="gif" alt="Kenny GIF will appear here" />
      </div>
    </div>

    <div class="card">
      <h3 style="margin:6px 0 10px">Our Little Gallery üì∏</h3>
      <div class="gallery" id="gallery"></div>
    </div>
  </div>

  <!-- Lightbox (photos) -->
  <div class="lightbox" id="lightbox" aria-modal="true" role="dialog">
    <div class="lightbox-inner">
      <img class="lightbox-img" id="lightboxImg" alt="Expanded photo" />
      <button class="lb-close" id="lbClose" aria-label="Close">√ó</button>
    </div>
  </div>

  <!-- Floating letter button -->
  <button class="fab-letter" id="letterBtn" aria-label="Open letter">üíå</button>
  <!-- NEW: Floating audio button -->
  <button class="fab-audio" id="audioBtn" aria-label="Play music">‚ñ∂Ô∏è</button>

  <!-- Letter modal -->
  <div class="letter-modal" id="letterModal" aria-modal="true" role="dialog" aria-hidden="true">
    <div class="letter-card" role="document">
      <button class="letter-close" id="letterClose" aria-label="Close">√ó</button>
      <div class="letter-title">To my Bebe, <span id="letterName">Nitika</span> ‚ú®</div>
      <div class="letter-body">
        <p>Happy birthday, beautiful sunshine. Today and every day, I‚Äôm grateful you exist. You light up rooms, playlists, timelines<em> and</em> my whole heart.</p>
        <p>I hope this year and more ahead to come brings you silly laughs, easy mornings, and the kind of joy that sneaks up on you in little moments. You deserve all the softness in the world.</p>
        <p>Thank you for being my favorite person, my calm, my chaos, and my forever crush. I love you more than I can put in a webpage. üíñ</p>
        <p class="letter-sign">‚Äî with all my love</p>
      </div>
    </div>
  </div>

  <script>
    /*** ‚ú® Customize here ‚ú® ***/
    const RECIPIENT_NAME = "NITIKA";
    let TYPE_LINES = [
      "Happy birthday, my love üéÇ","Today is all about you ‚ú®","May all your wishes come true üí´",
      "Another year more beautiful, more amazing, more YOU üåπ","Cheers to you and all the love you bring ü•Ç",
      "Forever grateful you were born üíñ","You‚Äôre my favorite notification üíå","Life is brighter with you in it üå∏",
      "You make my heart do a happy dance üé∂","You + me = my favorite equation üíï","Happiest when I see you laugh üòç",
      "My favorite place is right next to you üåô"
    ];
    for (let i = TYPE_LINES.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [TYPE_LINES[i], TYPE_LINES[j]] = [TYPE_LINES[j], TYPE_LINES[i]]; }

    const HER_PHOTOS = [];
    for (let i = 1; i <= 26; i++){
      if (i === 23) continue; // your exception
      HER_PHOTOS.push(`./img/img${i}.jpg`);
    }
    const FALLBACK_GIFS = [
      "https://media.giphy.com/media/8PTT2a7OoGe2gJTh08/giphy.gif",
      "https://media2.giphy.com/media/v1.Y2lkPTc5MGI3NjExMHEwd2hrMGczZG14bHprMWY1czZxbTZqcmp0NmJsYTZxNmoyeXg4dCZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/FGOyI3XnaQOrmPaonP/giphy.gif",
      "https://media0.giphy.com/media/v1.Y2lkPTc5MGI3NjExZGd2MHB0Zno5aHg2M3N0OHI1Z3ZlOGI0bHdhZDZwMDdxdGNndzlkMyZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9cw/vezy5ZDCPSLyEtXfBf/giphy.gif",
      "https://media4.giphy.com/media/v1.Y2lkPTc5MGI3NjExenU3YXh3eXBmemhqaHE0dWMzMzdnbTg3dWt0c3YyeHJoNGZva2p1ZCZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9cw/Mt53A7Y27PvicqDsG7/giphy.gif",
      "https://media2.giphy.com/media/v1.Y2lkPTc5MGI3NjExcWhzZ2xrcDd6c2h3aGd3anZ5dWF0MWxjZWtvN3Y5M2gwNWM2M3Q5ZyZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9dg/HQCxbu48bVLsgqQlh4/giphy.gif",
      "https://media2.giphy.com/media/v1.Y2lkPTc5MGI3NjExdTBhZ25mbWhwYWxpNXhrcGhzN2pybGlsOHAyN25xMDVuZTc3dTRrMiZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9cw/W1iUBcysGpYNhGBLOA/giphy.gif",
      "https://media3.giphy.com/media/v1.Y2lkPTc5MGI3NjExYXh2Nmoxa3R5cm5lYWczbWViM2YxdG80eGVwcnZxcHh3YWJmNHVreiZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9cw/JIOTHacwDM0Q0KiUGn/giphy.gif",
      "https://media1.giphy.com/media/v1.Y2lkPTc5MGI3NjExbG5hMGh6dGc4a3V0MjdrM3czdG9yaXJoYmN3bm94Z2w0OWpna3djeCZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/0UHcgFys9CBSGF1WSx/giphy.gif",
      "https://media.giphy.com/media/0UHcgFys9CBSGF1WSx/giphy.gif",
      "https://media.giphy.com/media/wHnZkguO1XSkoMNE7G/giphy.gif",
      "https://media.giphy.com/media/v1.Y2lkPWVjZjA1ZTQ3ejZ0eHo1bnVyNWl6aGxwNGpranNjaXF6Y2Jia2Nzc3ZxbHl2MXZtdSZlcD12MV9naWZzX3NlYXJjaCZjdT1n/XZnquLlXqEKqoEnHrH/giphy.gif",
      "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExc2MxNHdkc3R0bjNicm12dGM0ZTY3cnAzdzQ0ZjM5eXM5cWUzZ2hlZyZlcD12MV9naWZzX3NlYXJjaCZjdT1n/JWybLzXs7Hn0JKhSji/giphy.gif",
      "https://media.giphy.com/media/8PTT2a7OoGe2gJTh08/giphy.gif",
      "https://media.giphy.com/media/ChsrK4Xd54NZuhSx0V/giphy.gif",
      "https://media.giphy.com/media/EQUQdq1Mr94PUJtANv/giphy.gif",
      "https://media.giphy.com/media/OOThFgghwbqbNHuGNM/giphy.gif",
      "https://media.giphy.com/media/eaePuncU2HorDQFTjh/giphy.gif",
      "https://media.giphy.com/media/7TJXK0wFlYVeJYk3yH/giphy.gif",
      "https://media.giphy.com/media/HNIZE1bTsXxWq1okyZ/giphy.gif",
      "https://media.giphy.com/media/v1.Y2lkPWVjZjA1ZTQ3YjBvd3Q0a20xbmM4bW9nYnYyOHlxNnBwb3pwM3QwMzQ4bmphYXUyZyZlcD12MV9zdGlja2Vyc19zZWFyY2gmY3Q9cw/i70f6oiCQPfyQRtr1z/giphy.gif",
      "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExdGc0MHprdzNwNjZyOW95b3RyNXE2c2sxdXJxcG9reXF2emw1dDE1biZlcD12MV9naWZzX3NlYXJjaCZjdD1n/TlxaoEoAfBtZqpaYbZ/giphy.gif",
      "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExdGc0MHprdzNwNjZyOW95b3RyNXE2c2sxdXJxcG9reXF2emw1dDE1biZlcD12MV9naWZzX3NlYXJjaCZjdD1n/HNIZE1bTsXxWq1okyZ/giphy.gif",
      "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExdGc0MHprdzNwNjZyOW95b3RyNXE2c2sxdXJxcG9reXF2emw1dDE1biZlcD12MV9naWZzX3NlYXJjaCZjdD1n/gOR91aQKUTDvw02CBI/giphy.gif",
      "https://media.giphy.com/media/v1.Y2lkPWVjZjA1ZTQ3ZnQ4Njl2cGg1MDd5cmdyc2FjenZmN2U5eDJqaHZudG9jcmVldWdtMSZlcD12MV9naWZzX3NlYXJjaCZjdD1n/473m7FtcvZfZmmNw2D/giphy.gif",
      "https://media.giphy.com/media/b2TGLnnacYlHymJlR8/giphy.gif",
      "https://media.giphy.com/media/ltPfda24C6tq3S7WbZ/giphy.gif",
      "https://media.giphy.com/media/m6GN3Ek2Ab7TkQluAH/giphy.gif",
      "https://media.giphy.com/media/GCi8AiDxe1hcEMFMMg/giphy.gif",
      "https://media.giphy.com/media/vA624LLPtb6IMAneIW/giphy.gif",
      "https://media.giphy.com/media/cOdw8CNcNkkJBrWllC/giphy.gif",
      "https://media.giphy.com/media/5c7qU6I1qDI74glXqs/giphy.gif",
      "https://media.giphy.com/media/vxnVOD0TDa15uLtx7G/giphy.gif",
      "https://media.giphy.com/media/OOThFgghwbqbNHuGNM/giphy.gif"
    ];

    /*** Elements ***/
    const nameEl   = document.getElementById("name");
    const titleEl  = document.getElementById("title");
    const preTitle = document.getElementById("preTitle");
    const typeLine = document.getElementById("typeLine");
    const gifImg   = document.getElementById("gif");
    const btn      = document.getElementById("gifBtn");
    const gallery  = document.getElementById("gallery");
    const titleFX  = document.getElementById("titleFX");
    const effects  = document.getElementById("effects");
    const bgm      = document.getElementById("bgm");

    const lightbox = document.getElementById('lightbox');
    const lightboxImg = document.getElementById('lightboxImg');
    const lbClose = document.getElementById('lbClose');

    // Letter elements
    const letterBtn   = document.getElementById('letterBtn');
    const letterModal = document.getElementById('letterModal');
    const letterClose = document.getElementById('letterClose');
    const letterName  = document.getElementById('letterName');

    // NEW: audio button
    const audioBtn = document.getElementById('audioBtn');

    nameEl.textContent = RECIPIENT_NAME;
    if (letterName) letterName.textContent = RECIPIENT_NAME.charAt(0) + RECIPIENT_NAME.slice(1).toLowerCase();

    /* Click-anywhere to start music (once) */
    function startMusicOnce(){
      try { bgm.volume = 0.85; bgm.play().catch(()=>{}); } catch(e){}
      ['pointerdown','click','touchend','keydown'].forEach(evt=>{
        document.removeEventListener(evt, startMusicOnce, {capture:true});
      });
      setAudioIcon(); // update icon after auto-start
    }
    ['pointerdown','click','touchend','keydown'].forEach(evt=>{
      document.addEventListener(evt, startMusicOnce, {once:true, passive:true, capture:true});
    });

    /* NEW: play/pause control */
    function setAudioIcon(){
      if (!audioBtn) return;
      audioBtn.textContent = bgm.paused ? '‚ñ∂Ô∏è' : '‚è∏Ô∏è';
      audioBtn.setAttribute('aria-label', bgm.paused ? 'Play music' : 'Pause music');
    }
    if (audioBtn){
      audioBtn.addEventListener('click', async ()=>{
        try{
          if (bgm.paused){ await bgm.play(); } else { bgm.pause(); }
        }catch(e){}
        setAudioIcon();
      });
      setAudioIcon();
    }

    /* Sparkles behind the title */
    function sparkleBurst(durationMs=1600){
      const start = performance.now();
      const colors = ["tint1","tint2","tint3"];
      const rect = titleFX.getBoundingClientRect();
      const centerX = rect.width/2, centerY = rect.height/2;

      (function emit(){
        const now = performance.now();
        if (now - start > durationMs) return;
        const n = 3 + Math.floor(Math.random()*3);
        for (let i=0;i<n;i++){
          const s = document.createElement("div");
          s.className = "sparkle " + colors[Math.floor(Math.random()*colors.length)];
          const angle = Math.random()*Math.PI*2;
          const radius = 10 + Math.random()*80;
          s.style.left = (centerX + Math.cos(angle)*radius) + "px";
          s.style.top  = (centerY + Math.sin(angle)*radius) + "px";
          s.style.animationDelay = (Math.random()*0.12) + "s";
          titleFX.appendChild(s);
          setTimeout(()=> s.remove(), 1800);
        }
        requestAnimationFrame(emit);
      })();
    }

    /* Floaty celebration (non-cluttered) */
    const MAX_FLOAT_CONFETTI = 70;
    const MAX_FLOAT_EMOJIS   = 20;
    const MAX_FLOAT_HEARTS   = 16;

    const EMOJI_POOL = ["üéâ","üéä","üéà","‚ú®","üéÅ","ü•≥","üíñ","üíê","üéÇ"];
    const HEARTS_POOL = ["üíñ","üíò","üíù","üíï","üß°","üíó","üíì","üíû"];

    function rand(min,max){ return Math.random()*(max-min)+min; }

    function spawnConfettiPiece(){
      const d = document.createElement("div");
      d.className = "float-confetti";
      d.style.left = rand(2, 98) + "vw";
      d.style.top  = rand(2, 92) + "vh";
      d.style.background = `hsl(${Math.floor(Math.random()*360)}, 90%, 60%)`;
      d.style.borderRadius = Math.random()>.5 ? "2px" : "50%";
      d.style.setProperty('--dx', `${rand(-24,24)}px`);
      d.style.setProperty('--dy', `${rand(-28,28)}px`);
      d.style.setProperty('--dur', `${rand(12,20)}s`);
      effects.appendChild(d);
      setTimeout(()=> d.remove(), rand(50,80)*1000);
    }

    function spawnEmojiPiece(){
      const e = document.createElement("div");
      e.className = "float-emoji";
      e.textContent = EMOJI_POOL[Math.floor(Math.random()*EMOJI_POOL.length)];
      e.style.left = rand(3, 97) + "vw";
      e.style.top  = rand(5, 92) + "vh";
      e.style.setProperty('--size', `${rand(20,30)}px`);
      e.style.setProperty('--dx', `${rand(-20,20)}px`);
      e.style.setProperty('--dy', `${rand(-24,24)}px`);
      e.style.setProperty('--dur', `${rand(14,22)}s`);
      effects.appendChild(e);
      setTimeout(()=> e.remove(), rand(55,85)*1000);
    }

    function spawnHeartPiece(){
      const h = document.createElement("div");
      h.className = "float-heart";
      h.textContent = HEARTS_POOL[Math.floor(Math.random()*HEARTS_POOL.length)];
      h.style.left = rand(3, 97) + "vw";
      h.style.top  = rand(5, 92) + "vh";
      h.style.setProperty('--size', `${rand(18,28)}px`);
      h.style.setProperty('--dx', `${rand(-18,18)}px`);
      h.style.setProperty('--dy', `${rand(-22,22)}px`);
      h.style.setProperty('--dur', `${rand(16,24)}s`);
      effects.appendChild(h);
      setTimeout(()=> h.remove(), rand(60,90)*1000);
    }

    function maintainFloaters(){
      const confCount = effects.querySelectorAll('.float-confetti').length;
      const emoCount  = effects.querySelectorAll('.float-emoji').length;
      const heartCount= effects.querySelectorAll('.float-heart').length;
      for (let i=confCount; i<MAX_FLOAT_CONFETTI; i++) spawnConfettiPiece();
      for (let i=emoCount;  i<MAX_FLOAT_EMOJIS;   i++) spawnEmojiPiece();
      for (let i=heartCount;i<MAX_FLOAT_HEARTS;   i++) spawnHeartPiece();
    }

    // Burst hearts on GIF click
    function popHearts(){
      const N = 14;
      for(let i=0;i<N;i++){
        const h = document.createElement("div");
        h.className = "burst-heart";
        h.textContent = HEARTS_POOL[Math.floor(Math.random()*HEARTS_POOL.length)];
        h.style.left = (Math.random()*100) + "vw";
        h.style.bottom = "-6vh";
        h.style.animationDelay = (Math.random()*0.8)+"s";
        h.style.animationDuration = (3 + Math.random()*2)+"s";
        effects.appendChild(h);
        setTimeout(()=> h.remove(), 5200);
      }
    }

    /* Cross-fade, sparkles, and start floaters */
    function showHeadings(){
      const hold = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--hold-pretitle')) || 2600;
      const fade = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--fade-duration')) || 1600;
      const overlap = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--cross-overlap')) || 700;

      titleEl.classList.remove("show");
      preTitle.classList.add("show");

      setTimeout(()=>{
        sparkleBurst(1800);
        preTitle.classList.add("hide");
        setTimeout(()=>{
          titleEl.classList.add("show");
          maintainFloaters();
          setInterval(maintainFloaters, 5000);
        }, Math.max(0, fade - overlap));
      }, hold);
    }
    showHeadings();

    // Quotes rotation
    let typeIdx = 0;
    setInterval(() => {
      typeIdx = (typeIdx + 1) % TYPE_LINES.length;
      typeLine.textContent = TYPE_LINES[typeIdx];
    }, 2600);

    // Gallery
    function addPhoto(url){
      const wrap = document.createElement("div");
      wrap.className = "ph";
      const img = document.createElement("img");
      img.loading = "lazy"; img.alt = "Her photo"; img.src = url;
      wrap.appendChild(img); gallery.appendChild(wrap);
    }
    HER_PHOTOS.forEach(addPhoto);

    // Lightbox logic (click image to expand)
    gallery.addEventListener('click', (e)=>{
      const img = e.target.closest('.ph img');
      if(!img) return;
      lightboxImg.src = img.src;
      lightbox.classList.add('show');
    });
    function closeLightbox(){
      lightbox.classList.remove('show');
      lightboxImg.src = '';
    }
    lightbox.addEventListener('click', (e)=>{
      if(e.target === lightbox || e.target.id === 'lbClose') closeLightbox();
    });
    document.addEventListener('keydown', (e)=>{
      if(e.key === 'Escape') { closeLightbox(); closeLetter(); }
    });

    // GIF button: show new gif + burst hearts
    btn.addEventListener("click", ()=>{
      const url = FALLBACK_GIFS[Math.floor(Math.random()*FALLBACK_GIFS.length)];
      gifImg.src = url; gifImg.alt = "Kenny GIF";
      popHearts();
    });

    // Initial GIF
    gifImg.src = FALLBACK_GIFS[0];

    // ===== Letter modal logic =====
    function openLetter(){
      letterModal.classList.add('show');
      letterModal.setAttribute('aria-hidden','false');
      // add a tiny sprinkle on open
      popHearts();
    }
    function closeLetter(){
      letterModal.classList.remove('show');
      letterModal.setAttribute('aria-hidden','true');
    }
    letterBtn.addEventListener('click', openLetter);
    letterModal.addEventListener('click', (e)=>{
      if(e.target === letterModal || e.target.id === 'letterClose') closeLetter();
    });
  </script>
</body>
</html>
